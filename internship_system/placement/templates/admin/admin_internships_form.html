<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin | {% if is_edit %}Edit{% else %}Add{% endif %} Internship</title>

    <style>
        :root {
            --primary: #2563eb;
            --bg: #f4f6f9;
            --card: #ffffff;
            --text: #1f2937;
            --muted: #6b7280;
            --border: #e5e7eb;
        }

        * { box-sizing: border-box; font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }
        body { margin: 0; background: var(--bg); color: var(--text); }

        .page-wrapper { padding: 40px; max-width: 900px; margin: auto; }

        .card { background: var(--card); border-radius: 14px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); padding: 32px; }

        .card h1 { margin: 0 0 24px; font-size: 24px; }

        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }

        .form-group { display: flex; flex-direction: column; }
        .form-group.full { grid-column: span 2; }

        label { font-weight: 600; margin-bottom: 6px; }

        input, select, textarea { padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border); font-size: 14px; }
        textarea { resize: vertical; min-height: 100px; }

        .actions { margin-top: 30px; display: flex; justify-content: space-between; }

        .btn { padding: 10px 18px; border-radius: 8px; font-weight: 600; text-decoration: none; cursor: pointer; border: none; }
        .btn-back { background: #e5e7eb; color: #111827; }
        .btn-primary { background: var(--primary); color: white; }
        .btn:hover { opacity: 0.9; }

        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .form-group.full { grid-column: span 1; }
        }

        .field-error { color: red; font-size: 13px; margin-top: 4px; }
    </style>
</head>
<body>

<div class="page-wrapper">

    <div class="card">
        <h1>{% if is_edit %}✎ Edit{% else %}➕ Add{% endif %} Internship</h1>

        <form method="POST">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="field-error">{{ form.non_field_errors }}</div>
            {% endif %}

            <div class="form-grid">
                {% for field in form %}
                    <div class="form-group {% if field.field.widget.attrs.rows or field.field.widget.input_type == 'textarea' %}full{% endif %}">
                        {{ field.label_tag }}
                        {{ field }}
                        {% if field.errors %}
                            {% for error in field.errors %}
                                <div class="field-error">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                {% endfor %}
            </div>

            <div class="actions">
                <a href="{% url 'admin_internships_list' %}" class="btn btn-back">← Cancel</a>
                <button type="submit" class="btn btn-primary">{% if is_edit %}Update{% else %}Save Internship{% endif %}</button>
            </div>
        </form>
    </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const companySelect = document.getElementById('id_company');
    const departmentSelect = document.getElementById('id_department');

    if (!companySelect || !departmentSelect) return;

    // Remember the initially selected department (for editing)
    const selectedDept = departmentSelect.value;

    companySelect.addEventListener('change', function () {
        const companyId = this.value;

        // Reset department dropdown
        departmentSelect.innerHTML = '<option value="">---------</option>';

        if (!companyId) return;

        // Build URL dynamically
        const url = "{% url 'departments_by_company' 0 %}".replace('0', companyId);

        fetch(url)
            .then(res => res.json())
            .then(data => {
                data.forEach(dept => {
                    const option = document.createElement('option');
                    option.value = dept.id;
                    option.textContent = dept.name;

                    // Pre-select the saved department if editing
                    if (dept.id.toString() === selectedDept) {
                        option.selected = true;
                    }

                    departmentSelect.appendChild(option);
                });
            });
    });

    // Trigger change on page load to populate department
    if (companySelect.value) {
        companySelect.dispatchEvent(new Event('change'));
    }
});
</script>


</body>
</html>

