{% extends "student/base.html" %}
{% load static %}

{% block content %}
<h2>Available Internships</h2>

<!-- FILTER FORM -->
<form method="get" class="filter-form">
    <input type="text" name="q" placeholder="Search title or company"
           value="{{ request.GET.q }}">

    <select name="location">
        <option value="">All Locations</option>
        {% for loc in locations %}
            <option value="{{ loc }}" {% if request.GET.location == loc %}selected{% endif %}>
                {{ loc }}
            </option>
        {% endfor %}
    </select>

    <select name="sort">
        <option value="">Sort By</option>
        <option value="latest" {% if request.GET.sort == 'latest' %}selected{% endif %}>
            Latest
        </option>
        <option value="oldest" {% if request.GET.sort == 'oldest' %}selected{% endif %}>
            Oldest
        </option>
    </select>

    <button type="submit">Filter</button>
</form>

<hr>

<!-- INTERNSHIP LIST -->
{% for internship in internships %}
    <div class="card">
        <h3>{{ internship.title }}</h3>
        <p><strong>Company:</strong> {{ internship.company.company_name }}</p>
        <p><strong>Location:</strong> {{ internship.location }}</p>
        <p><strong>Duration:</strong> {{ internship.start_date }} - {{ internship.end_date }}</p>
        <p><strong>Slots:</strong> {{ internship.total_slots }}</p>

        {% if internship.internshipapplication_set.filter(student=request.user.student).exists %}
            <span>Already Applied</span>
        {% else %}
            <a href="{% url 'apply_internship' internship.id %}" class="btn">
                Apply Now
            </a>
        {% endif %}
    </div>
    <hr>
{% empty %}
    <p>No internships found.</p>
{% endfor %}
{% endblock %}
